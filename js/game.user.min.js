function User(){this.param_={token:"",name:"",score:0,mode:[],key:"",valid:0};this.refresh_=null;}User.prototype.setInfo=function(b,a){if(a&&$.type(a)=="string"){this.param_[a]=b;
}else{this.param_=b;}};User.prototype.info=function(a){var b=this.param_;if(b&&a){a=b[a]||"";}else{a=b;}return a;};User.prototype.init=function(b){var a=getCookie("FFL_key");
console.log(a);if(a){this.getUserByKey(a,function(c){b?b(c):null;});}};User.prototype.a=function(a,b){a.url="./ajax/comm.php";ajax(a,function(c){b?b(c):null;
});};User.prototype.setUserRefresh=function(){var a=this;clearTimeout(a.refresh_);a.refresh_=setTimeout(function(){if(a.info("token")){a.a({key:"set_user_status",token:a.info("token")},function(b){setCookie("FFL_key",b.key,b.valid);
});}a.setUserRefresh();},1000*a.info("valid"));};User.prototype.setUserUI=function(){var a=this.info();if(a){if(a.status==0){$("#info").hide();$("#cc").hide();
$("#changeMode").hide();}else{$("#info").show();$("#changeMode").show();$("#cc").show();$("#score").html(a.score);setCookie("FFL_key",a.key,a.valid);}}};
User.prototype.setUserScore=function(b){b=b||0;var a=this.info("score")+b;this.setInfo(a,"score");$("#score").html(a);};User.prototype.getChangeMode=function(){var a=this;
a.emptyChangeMode();a.a({key:"get_user_changeMode",token:this.info("token")},function(c){if(c.status){var b=$("#changeModeTemplate");$(c.res).each(function(e,f){var d=b.clone(false);
d.removeAttr("id").removeClass("act");d=a.setChangeMode(d,f);b.before(d);});a.setInfo(c.res,"mode");}});};User.prototype.setChangeMode=function(a,b){a.addClass("score-item-value").show().removeClass("act").find("span").html(b.name);
a.data("val",b);if(b.type==1){a.prop("title","英雄联盟");a.find("i").addClass("icon-lol");}if(b.type==2){a.prop("title","支付宝");a.find("i").addClass("icon-alipay");
}if($(".score-edit").length){a.unbind("click").click(function(){if($(this).hasClass("act")){$(this).removeClass("act");$(".score-edit").hide();}else{$(this).addClass("act").siblings().removeClass("act");
$(".score-edit").show();$("#score_del").show();$("#scoreEdit_account").val(b.account);$("#scoreEdit_name").val(b.name);$("#scoreEdit_type").val(b.type).attr("disabled",true);
if(b.type==1){var c=$("#scoreLol_server option[value="+b.remark+"]").show().prop("selected",true).text();$("#scoreLol_server").show();$("#scoreLol_log").show().attr("href","http://lolbox.duowan.com/playerDetail.php?serverName="+c+"&playerName="+b.name);
}if(b.type==2){$("#scoreLol_log").hide();$("#scoreLol_server").hide();}}});}if($("#scoreSelected").length){a.unbind("click").click(function(){if($(this).hasClass("act")){$(this).removeClass("act");
$("#scoreSelected").val("");}else{$(this).addClass("act").siblings().removeClass("act");$("#scoreSelected").val(b.id);}});}return a;};User.prototype.emptyChangeMode=function(){$(".score-item-value:not(#changeModeTemplate)").remove();
};User.prototype.initChangeMode=function(){$("#scoreEdit_account").val("");$("#scoreEdit_name").val("");$("#scoreEdit_type").val(1).prop("disabled",false);
$("#scoreLol_server option[value=1]").prop("selected",true);$("#score_del").hide();$("#scoreLol_log").hide();};User.prototype.addChangeMode=function(a,b){a=a||{};
this.a({key:"set_user_changeMode",token:this.info("token"),type:a.type,account:a.account,name:a.name,remark:a.remark},function(c){b?b(c):null;});};User.prototype.updateChangeMode=function(a,b){a=a||{};
this.a({key:"set_user_changeMode",id:a.id,account:a.account,name:a.name,remark:a.remark},function(c){b?b(c):null;});};User.prototype.delChangeMode=function(b,a){ajax({key:"delete_user_changeMode",id:b},function(c){a?a(c):null;
});};User.prototype.getUserByName=function(a,c){var b=this;ajax({_:"get_user_byname",name:a,token:b.info("token")},function(d,e){if(d.status){b.setInfo(d.user);
b.setUserUI();b.getChangeMode();b.getWelfareDaily(function(f){if(f.status){b.setUserScore(f.number);}});b.getWelfareHangup();b.setUserRefresh();}c?c(d):null;
});};User.prototype.getUserByKey=function(a,c){var b=this;ajax({key:"get_user_bykey",code:a},function(d,e){if(d.status){b.setInfo(d.user);b.setUserUI();
b.getChangeMode();b.getWelfareDaily(function(f){if(f.status){b.setUserScore(f.number);}});b.getWelfareHangup();b.setUserRefresh();}c?c(d):null;});};User.prototype.setTip=function(c,d){d=d||3000;
var b=$("#msg"),a=b.data("loop");b.css({display:"inline-block"}).find("em").html(c);clearTimeout(a);a=setTimeout(function(){b.hide();},d);b.data("loop",a);
};User.prototype.getWelfareDaily=function(a){ajax({key:"get_welfare_daily",token:this.info("token")},function(b){a?a(b):null;});};User.prototype.getWelfareHangup=function(){var c=this,a=60*3,b="FFL_Hangup_"+c.info("token"),d=getCookie(b)||a;
setTimeout(function(){if(d>0){d-=3;if(d<=0){d=a;ajax({key:"get_welfare_hangup",token:c.info("token")},function(e){c.setUserScore(e.number);});}}setCookie(b,d,60);
c.getWelfareHangup();},3000);};